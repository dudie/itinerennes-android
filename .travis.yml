language: java
jdk: openjdk6
env:
  matrix:
  - SDK=7  ABI=armeabi      # 2.1            Eclair
# - SDK=8  ABI=armeabi      # 2.2   - 2.2.3  Froyo
# - SDK=9  ABI=armeabi      # 2.3   - 2.3.2  Gingerbread
# - SDK=10 ABI=armeabi      # 2.3.3 - 2.3.7  Gingerbread
# - SDK=11 ABI=armeabi      # 3.0            Honeycomb
# - SDK=12 ABI=armeabi      # 3.1            Honeycomb
# - SDK=13 ABI=armeabi      # 3.2            Honeycomd
# - SDK=14 ABI=armeabi      # 4.0   - 4.0.2  Ice Cream Sandwich
# - SDK=15 ABI=armeabi      # 4.0.3 - 4.0.4  Ice Cream Sandwich
# - SDK=16 ABI=armeabi-v7a  # 4.1            Jelly Bean
# - SDK=17 ABI=armeabi-v7a  # 4.2            Jelly Bean
# - SDK=18 ABI=armeabi-v7a  # 4.2            Jelly Bean
# - SDK=19 ABI=armeabi-v7a  # 4.4            Kit Kat

before_install:
# Install base Android SDK
- sudo apt-get update -qq
- sudo apt-get install -qq xmlstarlet
- if [ `uname -m` = x86_64 ] ; then sudo apt-get install -qq --force-yes libgd2-xpm ia32-libs ia32-libs-multiarch ; fi
- wget --quiet http://dl.google.com/android/android-sdk_r22.3-linux.tgz -O android-sdk-linux.tgz
- tar xzf android-sdk-linux.tgz
- export ANDROID_HOME=$PWD/android-sdk-linux
- export PATH=${PATH}:${ANDROID_HOME}/tools:${ANDROID_HOME}/platform-tools

# Install required Android components.
- export PKGS=android-$SDK,android-14
- echo y | android update sdk --filter tools,build-tools-19.0.1,platform-tools,extra-android-m2repository,$PKGS --no-ui --all --force
- echo y | android update sdk --filter sysimg-16,sysimg-19 --no-ui --all --force

# Create and start emulator
- echo no | android create avd --force -n test -t android-$SDK --abi $ABI
- emulator -avd test -no-skin -no-audio -no-window &

# resolving dependencies and plugin dependencies in advance makes less output during the build
# before we download a base bundle with plugin dependencies
- wget --quiet https://downloads.sourceforge.net/project/dudie/maven-repository-plugins-bundle/m2-repo-plugins.tar.bz2 -O m2-repo.tar.bz2
- tar jxf m2-repo.tar.bz2 -C ~/.m2/repository
- mvn dependency:resolve-plugins

before_script:
# Make sure the emulator has started before running tests
- ./.travis/wait_for_emulator.sh

script: mvn install -Dandroid.device=test

after_script:
# find and display surefire test reports
- find -path "*/target/surefire-reports/*" -name 'TEST-*.xml' -exec sh -c "echo -e \\\n\\\n\\\n{}\\\n ; xmlstarlet fo {}" \;
